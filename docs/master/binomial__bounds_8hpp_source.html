<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>datasketches-cpp: common/include/binomial_bounds.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">datasketches-cpp
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bdd9a5d540de89e9fe90efdfc6973a4f.html">common</a></li><li class="navelem"><a class="el" href="dir_11fbc4217d50ab21044e5ad6614aede5.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">binomial_bounds.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * distributed with this work for additional information</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * to you under the Apache License, Version 2.0 (the</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * &quot;License&quot;); you may not use this file except in compliance</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * with the License.  You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Unless required by applicable law or agreed to in writing,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * software distributed under the License is distributed on an</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * KIND, either express or implied.  See the License for the</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * specific language governing permissions and limitations</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * under the License.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#ifndef BINOMIAL_BOUNDS_HPP_</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#define BINOMIAL_BOUNDS_HPP_</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * This class enables the estimation of error bounds given a sample set size, the sampling</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * probability theta, the number of standard deviations and a simple noDataSeen flag. This can</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * be used to estimate error bounds for fixed threshold sampling as well as the error bounds</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * calculations for sketches.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * author Alexander Saydakov</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * author Lee Rhodes</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * author Kevin Lang</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="namespacedatasketches.html">   38</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacedatasketches.html">datasketches</a> {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">double</span> delta_of_num_std_devs[] = {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  0.5000000000000000000, <span class="comment">// not actually using this value</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  0.1586553191586026479,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  0.0227502618904135701,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  0.0013498126861731796</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;};</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">double</span> lb_equiv_table[] = {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  1.0, 2.0, 3.0, <span class="comment">// fake values for k = 0</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  0.78733703534118149, 3.14426768537558132, 13.56789685109913535, <span class="comment">// k = 1</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  0.94091379266077979, 2.64699271711145911, 6.29302733018320737, <span class="comment">// k = 2</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  0.96869128474958188, 2.46531676590527127, 4.97375283467403051, <span class="comment">// k = 3</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  0.97933572521046131, 2.37418810664669877, 4.44899975481712318, <span class="comment">// k = 4</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  0.98479165917274258, 2.31863116255024693, 4.16712379778553554, <span class="comment">// k = 5</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  0.98806033915698777, 2.28075536565225434, 3.99010556144099837, <span class="comment">// k = 6</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  0.99021896790580399, 2.25302005857281529, 3.86784477136922078, <span class="comment">// k = 7</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  0.99174267079089873, 2.23168103978522936, 3.77784896945266269, <span class="comment">// k = 8</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  0.99287147837287648, 2.21465899260871879, 3.70851932988722410, <span class="comment">// k = 9</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  0.99373900046805375, 2.20070155496262032, 3.65326029076638292, <span class="comment">// k = 10</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  0.99442519013851438, 2.18900651202670815, 3.60803817612955413, <span class="comment">// k = 11</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  0.99498066823221620, 2.17903457780744247, 3.57024330407946877, <span class="comment">// k = 12</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  0.99543899410224412, 2.17040883161922693, 3.53810982030634591, <span class="comment">// k = 13</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  0.99582322541263579, 2.16285726913676513, 3.51039837124298515, <span class="comment">// k = 14</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  0.99614973311747690, 2.15617827879603396, 3.48621230377099778, <span class="comment">// k = 15</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  0.99643042892560629, 2.15021897666090922, 3.46488605693562590, <span class="comment">// k = 16</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  0.99667418783778317, 2.14486114872480016, 3.44591466064832730, <span class="comment">// k = 17</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  0.99688774875812669, 2.14001181420209718, 3.42890765690452781, <span class="comment">// k = 18</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  0.99707632299691795, 2.13559675336844634, 3.41355809420343803, <span class="comment">// k = 19</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  0.99724399084971083, 2.13155592217421486, 3.39962113251016262, <span class="comment">// k = 20</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  0.99739400151915447, 2.12784018863251845, 3.38689892877548004, <span class="comment">// k = 21</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  0.99752896842633731, 2.12440890875851096, 3.37522975271599535, <span class="comment">// k = 22</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  0.99765101725122918, 2.12122815311133195, 3.36448003577621080, <span class="comment">// k = 23</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  0.99776189496810730, 2.11826934724291505, 3.35453840911279144, <span class="comment">// k = 24</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  0.99786304821586214, 2.11550823850916458, 3.34531123809287578, <span class="comment">// k = 25</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  0.99795568665180667, 2.11292409529477254, 3.33671916527694634, <span class="comment">// k = 26</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  0.99804083063483517, 2.11049908609763293, 3.32869446834217797, <span class="comment">// k = 27</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  0.99811933910984862, 2.10821776918189130, 3.32117898316676019, <span class="comment">// k = 28</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  0.99819195457286014, 2.10606671027090897, 3.31412243534683171, <span class="comment">// k = 29</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  0.99825930555178388, 2.10403415237001923, 3.30748113008135647, <span class="comment">// k = 30</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  0.99832193858154028, 2.10210975877822648, 3.30121691946897045, <span class="comment">// k = 31</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  0.99838032666573895, 2.10028440670842542, 3.29529629751144171, <span class="comment">// k = 32</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  0.99843488390555990, 2.09855000145353188, 3.28968974413223236, <span class="comment">// k = 33</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  0.99848596721417948, 2.09689934193824001, 3.28437111460505093, <span class="comment">// k = 34</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  0.99853390005924325, 2.09532599155502908, 3.27931717312372939, <span class="comment">// k = 35</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  0.99857895741078551, 2.09382418262592296, 3.27450718840060517, <span class="comment">// k = 36</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  0.99862138880970974, 2.09238872751677718, 3.26992261182860489, <span class="comment">// k = 37</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  0.99866141580770318, 2.09101494715108061, 3.26554677962434425, <span class="comment">// k = 38</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  0.99869923565267982, 2.08969860402822860, 3.26136468165239535, <span class="comment">// k = 39</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  0.99873502010169091, 2.08843585627218431, 3.25736275677081721, <span class="comment">// k = 40</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  0.99876893292508839, 2.08722321436752623, 3.25352872241415980, <span class="comment">// k = 41</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  0.99880111078502409, 2.08605749165553789, 3.24985141664350863, <span class="comment">// k = 42</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  0.99883168573342118, 2.08493577529222307, 3.24632068399498053, <span class="comment">// k = 43</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  0.99886077231613513, 2.08385540129560809, 3.24292724848112357, <span class="comment">// k = 44</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  0.99888847451828155, 2.08281392374021834, 3.23966263299664092, <span class="comment">// k = 45</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  0.99891488795844907, 2.08180908991394631, 3.23651906111521726, <span class="comment">// k = 46</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  0.99894010085196783, 2.08083882998420222, 3.23348939240611344, <span class="comment">// k = 47</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  0.99896419358239541, 2.07990122528650545, 3.23056705515594444, <span class="comment">// k = 48</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  0.99898723510594323, 2.07899450946285924, 3.22774598963252402, <span class="comment">// k = 49</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  0.99900929266780736, 2.07811704477046533, 3.22502059972006805, <span class="comment">// k = 50</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  0.99903043086155208, 2.07726730587160091, 3.22238570890294795, <span class="comment">// k = 51</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  0.99905070073845081, 2.07644388314946582, 3.21983651940365689, <span class="comment">// k = 52</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  0.99907015770423868, 2.07564546080757850, 3.21736857351049821, <span class="comment">// k = 53</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  0.99908884779227947, 2.07487081196367740, 3.21497773796417619, <span class="comment">// k = 54</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  0.99910681586905525, 2.07411879634256024, 3.21266015316183484, <span class="comment">// k = 55</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  0.99912410177549305, 2.07338834403498140, 3.21041222805715165, <span class="comment">// k = 56</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  0.99914074347179849, 2.07267845454973099, 3.20823061166797174, <span class="comment">// k = 57</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  0.99915677607464204, 2.07198819052374006, 3.20611216970604573, <span class="comment">// k = 58</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  0.99917223149395795, 2.07131667846186929, 3.20405396962596001, <span class="comment">// k = 59</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  0.99918714153457699, 2.07066309019154460, 3.20205326110445299, <span class="comment">// k = 60</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  0.99920153247185794, 2.07002665203046377, 3.20010746990493544, <span class="comment">// k = 61</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  0.99921543193525508, 2.06940663431663552, 3.19821417453343315, <span class="comment">// k = 62</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  0.99922886570365677, 2.06880235245998279, 3.19637109973109546, <span class="comment">// k = 63</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  0.99924185357357942, 2.06821315729285971, 3.19457610621114441, <span class="comment">// k = 64</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  0.99925441845175555, 2.06763843812092318, 3.19282717869864996, <span class="comment">// k = 65</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  0.99926658263325407, 2.06707761824370095, 3.19112241228646099, <span class="comment">// k = 66</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  0.99927836173816331, 2.06653015295219689, 3.18946001739936946, <span class="comment">// k = 67</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  0.99928977431994781, 2.06599552505539918, 3.18783829446098821, <span class="comment">// k = 68</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  0.99930083753795884, 2.06547324585920933, 3.18625564538041317, <span class="comment">// k = 69</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  0.99931156864562354, 2.06496285191821016, 3.18471055124089730, <span class="comment">// k = 70</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  0.99932197985521043, 2.06446390392778767, 3.18320157510865442, <span class="comment">// k = 71</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  0.99933208559809827, 2.06397598606787369, 3.18172735837393361, <span class="comment">// k = 72</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  0.99934190032416836, 2.06349869971447220, 3.18028661102792398, <span class="comment">// k = 73</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  0.99935143390791836, 2.06303166975550312, 3.17887810481605015, <span class="comment">// k = 74</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  0.99936070171270330, 2.06257453607466346, 3.17750067581857820, <span class="comment">// k = 75</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  0.99936971103502970, 2.06212696042919674, 3.17615321728274580, <span class="comment">// k = 76</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  0.99937847392385493, 2.06168861430600714, 3.17483467831510779, <span class="comment">// k = 77</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  0.99938700168914352, 2.06125918927764928, 3.17354405480557489, <span class="comment">// k = 78</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  0.99939530099953799, 2.06083838987589729, 3.17228039269048168, <span class="comment">// k = 79</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  0.99940338278830154, 2.06042593411496000, 3.17104278166036124, <span class="comment">// k = 80</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  0.99941125463777780, 2.06002155276328835, 3.16983035274597569, <span class="comment">// k = 81</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  0.99941892470027938, 2.05962498741951094, 3.16864227952240185, <span class="comment">// k = 82</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  0.99942640059737187, 2.05923599161263837, 3.16747776846497686, <span class="comment">// k = 83</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  0.99943368842187397, 2.05885433061945378, 3.16633606416374391, <span class="comment">// k = 84</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  0.99944079790603269, 2.05847977868873500, 3.16521644518826406, <span class="comment">// k = 85</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  0.99944773295734990, 2.05811212058944193, 3.16411821883858124, <span class="comment">// k = 86</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  0.99945450059186669, 2.05775114781260982, 3.16304072400711789, <span class="comment">// k = 87</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  0.99946110646314423, 2.05739666442039493, 3.16198332650733960, <span class="comment">// k = 88</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  0.99946755770463369, 2.05704847678819647, 3.16094541781455973, <span class="comment">// k = 89</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  0.99947385746861528, 2.05670640500335367, 3.15992641851471490, <span class="comment">// k = 90</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  0.99948001256305474, 2.05637027420314666, 3.15892576988736096, <span class="comment">// k = 91</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  0.99948602689656241, 2.05603991286400856, 3.15794293484717059, <span class="comment">// k = 92</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  0.99949190674294641, 2.05571516158917689, 3.15697740043813724, <span class="comment">// k = 93</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  0.99949765436329585, 2.05539586490317561, 3.15602867309343083, <span class="comment">// k = 94</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  0.99950327557880314, 2.05508187237845164, 3.15509627710042651, <span class="comment">// k = 95</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  0.99950877461972709, 2.05477304104951486, 3.15417975753007340, <span class="comment">// k = 96</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  0.99951415481862682, 2.05446923022574879, 3.15327867462917766, <span class="comment">// k = 97</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  0.99951942042375208, 2.05417030908833453, 3.15239260700215596, <span class="comment">// k = 98</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  0.99952457390890004, 2.05387614661762541, 3.15152114915238712, <span class="comment">// k = 99</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  0.99952962005008317, 2.05358662050909402, 3.15066390921020911, <span class="comment">// k = 100</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  0.99953456216121594, 2.05330161104427589, 3.14982051097524618, <span class="comment">// k = 101</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  0.99953940176368405, 2.05302100378725072, 3.14899059183684926, <span class="comment">// k = 102</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  0.99954414373920031, 2.05274468493067275, 3.14817379948561893, <span class="comment">// k = 103</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  0.99954879047621148, 2.05247255013657082, 3.14736979964868624, <span class="comment">// k = 104</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  0.99955334485656522, 2.05220449388099269, 3.14657826610371671, <span class="comment">// k = 105</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  0.99955780993869325, 2.05194041831310869, 3.14579888316276879, <span class="comment">// k = 106</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  0.99956218652590678, 2.05168022402710903, 3.14503134811607765, <span class="comment">// k = 107</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  0.99956647932785359, 2.05142381889103831, 3.14427536967733090, <span class="comment">// k = 108</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  0.99957069025060719, 2.05117111251445294, 3.14353066260227365, <span class="comment">// k = 109</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  0.99957482032178291, 2.05092201793428330, 3.14279695558593630, <span class="comment">// k = 110</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  0.99957887261450651, 2.05067645094720774, 3.14207398336887422, <span class="comment">// k = 111</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  0.99958284988383639, 2.05043432833224415, 3.14136149076028914, <span class="comment">// k = 112</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  0.99958675435604505, 2.05019557189746138, 3.14065923143530767, <span class="comment">// k = 113</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  0.99959058650074439, 2.04996010556124020, 3.13996696426707445, <span class="comment">// k = 114</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  0.99959434898201494, 2.04972785368377686, 3.13928445867830419, <span class="comment">// k = 115</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  0.99959804437042976, 2.04949874512311681, 3.13861149103462367, <span class="comment">// k = 116</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  0.99960167394553423, 2.04927271043337100, 3.13794784369528656, <span class="comment">// k = 117</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  0.99960523957651048, 2.04904968140490951, 3.13729330661277572, <span class="comment">// k = 118</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  0.99960874253329735, 2.04882959397491504, 3.13664767767019725, <span class="comment">// k = 119</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  0.99961218434327748, 2.04861238220240693, 3.13601075688413289  <span class="comment">// k = 120</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;};</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">double</span> ub_equiv_table[] = {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  1.0, 2.0, 3.0, <span class="comment">// fake values for k = 0</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  0.99067760836669549, 1.75460517119302040, 2.48055626001627161, <span class="comment">// k = 1</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  0.99270518097577565, 1.78855957509907171, 2.53863835259832626, <span class="comment">// k = 2</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  0.99402032633599902, 1.81047286499563143, 2.57811676180597260, <span class="comment">// k = 3</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  0.99492607629539975, 1.82625928017762362, 2.60759550546498531, <span class="comment">// k = 4</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  0.99558653966013821, 1.83839160339161367, 2.63086812358551470, <span class="comment">// k = 5</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  0.99608981951632813, 1.84812399034444752, 2.64993712523727254, <span class="comment">// k = 6</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  0.99648648035983456, 1.85617372053235385, 2.66598485907860550, <span class="comment">// k = 7</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  0.99680750790483330, 1.86298655802610824, 2.67976541374471822, <span class="comment">// k = 8</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  0.99707292880049181, 1.86885682585270274, 2.69178781407745760, <span class="comment">// k = 9</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  0.99729614928489241, 1.87398826101983218, 2.70241106542158604, <span class="comment">// k = 10</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  0.99748667952445658, 1.87852708449801753, 2.71189717290596377, <span class="comment">// k = 11</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  0.99765127712748836, 1.88258159501103250, 2.72044290303773550, <span class="comment">// k = 12</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  0.99779498340305395, 1.88623391878036273, 2.72819957382063194, <span class="comment">// k = 13</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  0.99792160418357412, 1.88954778748873764, 2.73528576807902368, <span class="comment">// k = 14</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  0.99803398604944960, 1.89257337682371940, 2.74179612106766513, <span class="comment">// k = 15</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  0.99813449883217231, 1.89535099316557876, 2.74780718300419835, <span class="comment">// k = 16</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  0.99822494122659577, 1.89791339232732525, 2.75338173141955167, <span class="comment">// k = 17</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  0.99830679915913834, 1.90028752122407241, 2.75857186416826039, <span class="comment">// k = 18</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  0.99838117410831728, 1.90249575897183831, 2.76342117562634826, <span class="comment">// k = 19</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  0.99844913407071090, 1.90455689090418900, 2.76796659454200267, <span class="comment">// k = 20</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  0.99851147736424650, 1.90648682834171268, 2.77223944710058845, <span class="comment">// k = 21</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  0.99856879856019987, 1.90829917277082473, 2.77626682032629901, <span class="comment">// k = 22</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  0.99862183849734265, 1.91000561415842185, 2.78007199816156003, <span class="comment">// k = 23</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  0.99867096266018507, 1.91161621560812023, 2.78367524259661536, <span class="comment">// k = 24</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  0.99871656986212543, 1.91313978579765376, 2.78709435016625662, <span class="comment">// k = 25</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  0.99875907577771272, 1.91458400425526065, 2.79034488416175463, <span class="comment">// k = 26</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  0.99879885565047744, 1.91595563175945927, 2.79344064132371273, <span class="comment">// k = 27</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  0.99883610756373287, 1.91726064301425936, 2.79639384757751941, <span class="comment">// k = 28</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  0.99887095169674467, 1.91850441099725799, 2.79921543574803877, <span class="comment">// k = 29</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  0.99890379414739527, 1.91969155477030995, 2.80191513182441554, <span class="comment">// k = 30</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  0.99893466279047516, 1.92082633358913313, 2.80450167352080371, <span class="comment">// k = 31</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  0.99896392088177777, 1.92191254955568525, 2.80698295731653502, <span class="comment">// k = 32</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  0.99899147889385631, 1.92295362479495680, 2.80936614404217266, <span class="comment">// k = 33</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  0.99901764688726757, 1.92395267400968351, 2.81165765979318394, <span class="comment">// k = 34</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  0.99904238606342233, 1.92491244978191389, 2.81386337393604435, <span class="comment">// k = 35</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  0.99906590152386343, 1.92583552644848055, 2.81598868034527072, <span class="comment">// k = 36</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  0.99908829040739988, 1.92672418013918900, 2.81803841726804194, <span class="comment">// k = 37</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  0.99910959420023460, 1.92758051694144683, 2.82001709302821268, <span class="comment">// k = 38</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  0.99912996403594434, 1.92840654943159961, 2.82192875763732332, <span class="comment">// k = 39</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  0.99914930224576892, 1.92920397044028391, 2.82377730628954282, <span class="comment">// k = 40</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  0.99916781270195543, 1.92997447498220254, 2.82556612075063640, <span class="comment">// k = 41</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  0.99918553179077207, 1.93071949211818605, 2.82729843191989971, <span class="comment">// k = 42</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  0.99920250730914972, 1.93144048613876862, 2.82897728689417249, <span class="comment">// k = 43</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  0.99921873345181211, 1.93213870990595638, 2.83060537017752267, <span class="comment">// k = 44</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  0.99923435180002684, 1.93281536508689555, 2.83218527795750674, <span class="comment">// k = 45</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  0.99924930425362390, 1.93347145882316340, 2.83371938965598247, <span class="comment">// k = 46</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  0.99926370394567243, 1.93410820221384938, 2.83520990872793277, <span class="comment">// k = 47</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  0.99927750755296074, 1.93472643138986200, 2.83665891945119597, <span class="comment">// k = 48</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  0.99929082941537217, 1.93532697329771963, 2.83806833931606661, <span class="comment">// k = 49</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  0.99930366295501472, 1.93591074716263734, 2.83943997143404658, <span class="comment">// k = 50</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  0.99931598804721489, 1.93647857274021362, 2.84077557836653227, <span class="comment">// k = 51</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  0.99932789059798210, 1.93703110239354714, 2.84207662106302905, <span class="comment">// k = 52</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  0.99933946180485123, 1.93756904936378760, 2.84334468086129277, <span class="comment">// k = 53</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  0.99935053819703512, 1.93809302131219852, 2.84458116874117195, <span class="comment">// k = 54</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  0.99936126637970801, 1.93860365411038060, 2.84578731838604426, <span class="comment">// k = 55</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  0.99937166229284458, 1.93910149816429112, 2.84696443486512862, <span class="comment">// k = 56</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  0.99938169190727422, 1.93958709548454067, 2.84811369085281285, <span class="comment">// k = 57</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  0.99939136927613959, 1.94006085573701625, 2.84923617230361970, <span class="comment">// k = 58</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  0.99940074328745254, 1.94052339623206649, 2.85033291216254270, <span class="comment">// k = 59</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  0.99940993070470086, 1.94097508636855309, 2.85140492437699322, <span class="comment">// k = 60</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  0.99941868577388959, 1.94141633372043998, 2.85245314430358121, <span class="comment">// k = 61</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  0.99942734443487780, 1.94184757038001976, 2.85347839582286156, <span class="comment">// k = 62</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  0.99943556385736088, 1.94226915100517772, 2.85448160365493209, <span class="comment">// k = 63</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  0.99944374522542034, 1.94268143723749631, 2.85546346373061510, <span class="comment">// k = 64</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  0.99945159955424856, 1.94308482059116727, 2.85642486111805738, <span class="comment">// k = 65</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  0.99945915301904620, 1.94347956957849988, 2.85736639994965458, <span class="comment">// k = 66</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  0.99946660663832176, 1.94386600964031686, 2.85828887832701639, <span class="comment">// k = 67</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  0.99947383703224091, 1.94424436597356021, 2.85919278275500233, <span class="comment">// k = 68</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  0.99948075442870277, 1.94461502153473020, 2.86007887186090670, <span class="comment">// k = 69</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  0.99948766082269458, 1.94497821937304138, 2.86094774077355396, <span class="comment">// k = 70</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  0.99949422748713346, 1.94533411296001191, 2.86179981848076181, <span class="comment">// k = 71</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  0.99950070756119658, 1.94568300035135167, 2.86263579405672886, <span class="comment">// k = 72</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  0.99950704321753392, 1.94602523449961495, 2.86345610449197352, <span class="comment">// k = 73</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  0.99951320334216121, 1.94636083782822311, 2.86426125541271404, <span class="comment">// k = 74</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  0.99951920293474927, 1.94669011080745236, 2.86505169255406145, <span class="comment">// k = 75</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  0.99952501670378524, 1.94701327348536779, 2.86582788270862920, <span class="comment">// k = 76</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  0.99953071209267819, 1.94733044372333097, 2.86659027602854621, <span class="comment">// k = 77</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  0.99953632734991515, 1.94764180764266825, 2.86733927778843167, <span class="comment">// k = 78</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  0.99954171164873173, 1.94794766430732125, 2.86807526143834934, <span class="comment">// k = 79</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  0.99954699274462655, 1.94824807472994621, 2.86879864789403882, <span class="comment">// k = 80</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  0.99955216611081710, 1.94854317889829076, 2.86950970901679625, <span class="comment">// k = 81</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  0.99955730019613043, 1.94883320227168610, 2.87020887436986527, <span class="comment">// k = 82</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  0.99956213770650493, 1.94911826561721568, 2.87089648477021342, <span class="comment">// k = 83</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  0.99956704264963037, 1.94939848545763539, 2.87157281693902178, <span class="comment">// k = 84</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  0.99957166306481327, 1.94967401618316671, 2.87223821840905202, <span class="comment">// k = 85</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  0.99957632713136491, 1.94994497791333288, 2.87289293193450135, <span class="comment">// k = 86</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  0.99958087233392234, 1.95021155752212394, 2.87353731228213860, <span class="comment">// k = 87</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  0.99958532555996271, 1.95047376805584349, 2.87417154907075201, <span class="comment">// k = 88</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  0.99958956246481989, 1.95073180380688882, 2.87479599765507032, <span class="comment">// k = 89</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  0.99959389351869277, 1.95098572880579013, 2.87541081987382086, <span class="comment">// k = 90</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  0.99959807862052230, 1.95123574036898617, 2.87601637401948551, <span class="comment">// k = 91</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  0.99960214057801977, 1.95148186921983324, 2.87661283691068093, <span class="comment">// k = 92</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  0.99960607527256684, 1.95172415829728152, 2.87720042968334155, <span class="comment">// k = 93</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  0.99960996433179616, 1.95196280898670693, 2.87777936649376898, <span class="comment">// k = 94</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  0.99961379137860717, 1.95219787713926962, 2.87834989933620022, <span class="comment">// k = 95</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  0.99961756088146103, 1.95242944583677058, 2.87891216133900230, <span class="comment">// k = 96</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  0.99962125605327401, 1.95265762420910960, 2.87946647367488140, <span class="comment">// k = 97</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  0.99962486179100551, 1.95288245314810638, 2.88001290210658567, <span class="comment">// k = 98</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  0.99962843240297161, 1.95310404286672679, 2.88055166523392359, <span class="comment">// k = 99</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  0.99963187276145504, 1.95332251980147475, 2.88108300006589957, <span class="comment">// k = 100</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  0.99963525453173929, 1.95353785898848287, 2.88160703591438505, <span class="comment">// k = 101</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  0.99963855412988778, 1.95375019354571577, 2.88212393551896184, <span class="comment">// k = 102</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  0.99964190254169694, 1.95395953472205974, 2.88263389761985422, <span class="comment">// k = 103</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  0.99964506565942202, 1.95416607430155409, 2.88313700661564098, <span class="comment">// k = 104</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  0.99964834424233118, 1.95436972855640079, 2.88363350163803034, <span class="comment">// k = 105</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  0.99965136548857458, 1.95457068540693513, 2.88412349413960101, <span class="comment">// k = 106</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  0.99965436594726498, 1.95476896383092935, 2.88460710620208260, <span class="comment">// k = 107</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  0.99965736463468602, 1.95496457504532373, 2.88508450078833789, <span class="comment">// k = 108</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  0.99966034130443404, 1.95515761150707590, 2.88555580586194083, <span class="comment">// k = 109</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  0.99966326130828520, 1.95534810382198998, 2.88602118761679094, <span class="comment">// k = 110</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  0.99966601446035952, 1.95553622237747504, 2.88648066384146773, <span class="comment">// k = 111</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  0.99966887679593697, 1.95572186728168163, 2.88693444915907094, <span class="comment">// k = 112</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  0.99967161286551232, 1.95590523410490391, 2.88738271495714116, <span class="comment">// k = 113</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  0.99967435412270333, 1.95608626483223702, 2.88782540459769166, <span class="comment">// k = 114</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  0.99967701261934394, 1.95626497627117146, 2.88826277189363623, <span class="comment">// k = 115</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  0.99967963265157778, 1.95644153684824573, 2.88869486674335008, <span class="comment">// k = 116</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  0.99968216317182623, 1.95661589936000269, 2.88912184353694101, <span class="comment">// k = 117</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  0.99968479674396349, 1.95678821614791332, 2.88954376359643561, <span class="comment">// k = 118</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  0.99968729031337489, 1.95695842061650183, 2.88996069422501023, <span class="comment">// k = 119</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  0.99968963358631413, 1.95712651709766305, 2.89037285320668502  <span class="comment">// k = 120</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;};</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keyword">class </span>binomial_bounds {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> get_lower_bound(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> theta, <span class="keywordtype">unsigned</span> num_std_devs) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    check_theta(theta);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    check_num_std_devs(num_std_devs);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> estimate = num_samples / theta;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> lb = compute_approx_binomial_lower_bound(num_samples, theta, num_std_devs);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> std::min(estimate, std::max(<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(num_samples), lb));</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> get_upper_bound(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> theta, <span class="keywordtype">unsigned</span> num_std_devs) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    check_theta(theta);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    check_num_std_devs(num_std_devs);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> estimate = num_samples / theta;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> ub = compute_approx_binomial_upper_bound(num_samples, theta, num_std_devs);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">return</span> std::max(estimate, ub);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">// our &quot;classic&quot; bounds, but now with continuity correction</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> cont_classic_lb(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> num_std_devs) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> n_hat = (num_samples - 0.5) / theta;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> b = num_std_devs * std::sqrt((1.0 - theta) / theta);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> d  = 0.5 * b * std::sqrt((b * b) + (4.0 * n_hat));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> center = n_hat + (0.5 * (b * b));</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">return</span> (center - d);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="comment">// our &quot;classic&quot; bounds, but now with continuity correction</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> cont_classic_ub(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> num_std_devs) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> n_hat = (num_samples + 0.5) / theta;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> b = num_std_devs * std::sqrt((1.0 - theta) / theta);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> d  = 0.5 * b * std::sqrt((b * b) + (4.0 * n_hat));</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> center = n_hat + (0.5 * (b * b));</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">return</span> (center + d);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// This is a special purpose calculator for NStar, using a computational</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// strategy inspired by its Bayesian definition. It is only appropriate</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="comment">// for a very limited set of inputs. However, the procedure compute_approx_binomial_lower_bound()</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// below does in fact only call it for suitably limited inputs.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">// Outside of this limited range, two different bad things will happen.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">// First, because we are not using logarithms, the values of intermediate</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="comment">// quantities will exceed the dynamic range of doubles. Second, even if that</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">// problem were fixed, the running time of this procedure is essentially linear</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// in est = (numSamples / p), and that can be Very, Very Big.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> special_n_star(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> p, <span class="keywordtype">double</span> delta) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> q = 1.0 - p;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// Use a different algorithm if the following is true; this one will be too slow, or worse.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> ((num_samples / p) &gt;= 500.0) <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;out of range&quot;</span>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">double</span> cur_term = std::pow(p, num_samples);  <span class="comment">// curTerm = posteriorProbability (k, k, p)</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (cur_term &lt;= 1e-100) <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;out of range&quot;</span>); <span class="comment">// sanity check for non-use of logarithms</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordtype">double</span> tot = cur_term;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> m = num_samples;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">while</span> (tot &lt;= delta) { <span class="comment">// this test can fail even the first time</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      cur_term = (cur_term * q * (m)) / ((m + 1) - num_samples);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      tot += cur_term;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      m += 1;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// we have reached a state where tot &gt; delta, so back up one</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">return</span> (m - 1);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">//  The following procedure has very limited applicability.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">//  The above remarks about special_n_star() also apply here.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> special_n_prime_b(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> p, <span class="keywordtype">double</span> delta) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> q = 1.0 - p;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> one_minus_delta = 1.0 - delta;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordtype">double</span> cur_term = std::pow(p, num_samples);  <span class="comment">// curTerm = posteriorProbability (k, k, p)</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (cur_term &lt;= 1e-100) <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;out of range&quot;</span>); <span class="comment">// sanity check for non-use of logarithms</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">double</span> tot = cur_term;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> m = num_samples;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">while</span> (tot &lt; one_minus_delta) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      cur_term = (cur_term * q * (m)) / ((m + 1) - num_samples);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      tot += cur_term;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      m += 1;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">return</span> m; <span class="comment">// no need to back up</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> special_n_prime_f(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> p, <span class="keywordtype">double</span> delta) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">// Use a different algorithm if the following is true; this one will be too slow, or worse.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> ((num_samples / p) &gt;= 500.0) <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;out of range&quot;</span>); <span class="comment">//A super-small delta could also make it slow.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> special_n_prime_b(num_samples + 1, p, delta);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">// The following computes an approximation to the lower bound of a Frequentist</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// confidence interval based on the tails of the Binomial distribution.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> compute_approx_binomial_lower_bound(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> theta, <span class="keywordtype">unsigned</span> num_std_devs) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (theta == 1) <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(num_samples);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (num_samples == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span> (num_samples == 1) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> delta = delta_of_num_std_devs[num_std_devs];</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> raw_lb = std::log(1 - delta) / std::log(1 - theta);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">return</span> std::floor(raw_lb); <span class="comment">// round down</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (num_samples &gt; 120) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="comment">// plenty of samples, so gaussian approximation to binomial distribution isn&#39;t too bad</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> raw_lb = cont_classic_lb(num_samples, theta, num_std_devs);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordflow">return</span> (raw_lb - 0.5); <span class="comment">// fake round down</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">// at this point we know 2 &lt;= num_samples &lt;= 120</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (theta &gt; (1 - 1e-5)) { <span class="comment">// empirically-determined threshold</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(num_samples);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (theta &lt; (num_samples / 360.0)) { <span class="comment">// empirically-determined threshold</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="comment">// here we use the Gaussian approximation, but with a modified num_std_devs</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> index = 3 * <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(num_samples) + (num_std_devs - 1);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> raw_lb = cont_classic_lb(num_samples, theta, lb_equiv_table[index]);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">return</span> raw_lb - 0.5; <span class="comment">// fake round down</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">// This is the most difficult range to approximate; we will compute an &quot;exact&quot; LB.</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">// We know that est &lt;= 360, so specialNStar() shouldn&#39;t be ridiculously slow.</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> delta = delta_of_num_std_devs[num_std_devs];</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(special_n_star(num_samples, theta, delta)); <span class="comment">// no need to round</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="comment">// The following computes an approximation to the upper bound of a Frequentist</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="comment">// confidence interval based on the tails of the Binomial distribution.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> compute_approx_binomial_upper_bound(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> num_samples, <span class="keywordtype">double</span> theta, <span class="keywordtype">unsigned</span> num_std_devs) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span> (theta == 1) <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(num_samples);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (num_samples == 0) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> delta = delta_of_num_std_devs[num_std_devs];</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> raw_ub = std::log(delta) / std::log(1 - theta);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">return</span> std::ceil(raw_ub); <span class="comment">// round up</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">if</span> (num_samples &gt; 120) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="comment">// plenty of samples, so gaussian approximation to binomial distribution isn&#39;t too bad</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> raw_ub = cont_classic_ub(num_samples, theta, num_std_devs);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">return</span> (raw_ub + 0.5); <span class="comment">// fake round up</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// at this point we know 2 &lt;= num_samples &lt;= 120</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (theta &gt; (1 - 1e-5)) { <span class="comment">// empirically-determined threshold</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(num_samples + 1);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> (theta &lt; (num_samples / 360.0)) { <span class="comment">// empirically-determined threshold</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="comment">// here we use the Gaussian approximation, but with a modified num_std_devs</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> index = 3 * <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(num_samples) + (num_std_devs - 1);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> raw_ub = cont_classic_ub(num_samples, theta, ub_equiv_table[index]);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordflow">return</span> raw_ub + 0.5; <span class="comment">// fake round up</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// This is the most difficult range to approximate; we will compute an &quot;exact&quot; UB.</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// We know that est &lt;= 360, so specialNPrimeF() shouldn&#39;t be ridiculously slow.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> delta = delta_of_num_std_devs[num_std_devs];</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(special_n_prime_f(num_samples, theta, delta)); <span class="comment">// no need to round</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> check_theta(<span class="keywordtype">double</span> theta) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">if</span> (theta &lt; 0 || theta &gt; 1) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;theta must be in [0, 1]&quot;</span>);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> check_num_std_devs(<span class="keywordtype">unsigned</span> num_std_devs) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (num_std_devs &lt; 1 || num_std_devs &gt; 3) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;num_std_devs must be 1, 2 or 3&quot;</span>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;};</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;} <span class="comment">/* namespace datasketches */</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="ttc" id="anamespacedatasketches_html"><div class="ttname"><a href="namespacedatasketches.html">datasketches</a></div><div class="ttdoc">DataSketches namespace.</div><div class="ttdef"><b>Definition:</b> binomial_bounds.hpp:38</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
